---
title: axios请求失败时自动重新发起请求
tags: 
- 前端
---

`axios`的请求拦截器可以获取请求的地址、参数、超时时间等配置，我们可以利用拦截器进行失败请求的重新发起

在全局`axios`的拦截器中加入代码如下配置

```javascript
// 设置重新请求的次数
axios.defaults.retry = 3;
// 设置重新请求的时间间隔
axios.defaults.retryDelay = 1000;
axios.interceptors.response.use(undefined, function axiosRetryInterceptor(err) {
    const config = err.config;
    // 如果config不存在或未设置重试选项，请拒绝
    if (!config || !config.retry) return Promise.reject(err)
    // 设置变量跟踪重试次数
    config.__retryCount = config.__retryCount || 0;
    // 检查是否已经达到最大重试总次数
    if (config.__retryCount >= config.retry) {
        // 抛出错误信息
        return Promise.reject(err);
    }
    // 增加请求重试次数
    config.__retryCount += 1;
    // 创建新的异步请求
    const backoff = new Promise(function(resolve) {
        setTimeout(function() {
            resolve();
        }, config.retryDelay || 1)
    })
    // 返回axios信息，重新请求
    return backoff.then(function() {
        return axios(config);
    })
})
```

